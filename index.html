<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SWITZELINT â€“ BIM Project Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f3f4f6}
.app{display:flex;height:100vh}
.hidden{display:none}

/* Sidebar */
.sidebar{width:300px;background:#1f2933;color:#fff;padding:20px}
.sidebar h1{font-size:18px;margin:0}
.sidebar h2{font-size:13px;color:#cbd5e1;margin:6px 0 10px}
.sidebar button, .sidebar select{
width:100%;padding:10px;margin:6px 0;border:none;
background:#374151;color:#fff;border-radius:4px;cursor:pointer}
.item{
padding:8px;background:#111827;margin-bottom:6px;
border-radius:4px;cursor:pointer;font-size:14px}

/* Main */
.main{flex:1;padding:20px;overflow:auto}
.header{display:flex;gap:10px;margin-bottom:20px}
.header input{font-size:18px;padding:6px;flex:1}

/* KPIs */
.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}
.kpi{background:#fff;padding:14px;border-radius:6px}
.kpi strong{font-size:24px}

/* Table */
.table{background:#fff;border-radius:6px;padding:14px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e5e7eb;font-size:14px}
input.small, select.small{width:100%;padding:6px}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<div class="sidebar">
  <h1>SWITZELINT</h1>
  <h2>BIM Project Control</h2>

  <!-- ROLE SELECTOR -->
  <select id="roleSelect" onchange="setRole()">
    <option>BIM Manager</option>
    <option>Team Member</option>
    <option>Client</option>
  </select>

  <div id="managerControls">
    <button onclick="addProject()">+ Add Project</button>
    <button onclick="addTeam()">+ Add Team</button>
  </div>

  <div id="projectList"></div>
</div>

<!-- MAIN -->
<div class="main">
  <div class="header">
    <input id="projectName">
    <button id="addIsoBtn" onclick="addContainer()">+ Add ISO</button>
  </div>

  <div class="kpis">
    <div class="kpi">Containers<br><strong id="kpiTotal">0</strong></div>
    <div class="kpi">Published<br><strong id="kpiPublished">0</strong></div>
    <div class="kpi">WIP<br><strong id="kpiWip">0</strong></div>
    <div class="kpi">Shared<br><strong id="kpiShared">0</strong></div>
  </div>

  <div class="table">
    <table>
      <thead>
        <tr>
          <th>ID</th><th>Team</th><th>Status</th><th>LOD</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

</div>

<script>
/* ===== DATA ===== */
let data = JSON.parse(localStorage.getItem("bimData"));
if(!data){
  data = {
    role:"BIM Manager",
    active:0,
    teams:["ARC","STR","MEP"],
    projects:[{name:"Hospital Project",containers:[]}]
  };
  save();
}
function save(){ localStorage.setItem("bimData",JSON.stringify(data)); }

/* ===== ROLE ===== */
function setRole(){
  data.role = roleSelect.value;
  save();
  applyRole();
}
function applyRole(){
  const isManager = data.role==="BIM Manager";
  managerControls.classList.toggle("hidden",!isManager);
  addIsoBtn.classList.toggle("hidden",!isManager);
  projectName.disabled = !isManager;
  render();
}

/* ===== PROJECTS ===== */
function addProject(){
  data.projects.push({name:"New Project",containers:[]});
  data.active=data.projects.length-1;
  render();
}
function selectProject(i){ data.active=i; render(); }

/* ===== TEAMS ===== */
function addTeam(){
  const t=prompt("Team name");
  if(t){ data.teams.push(t); render(); }
}

/* ===== ISO ===== */
function addContainer(){
  data.projects[data.active].containers.push({
    id:"NEW-CONTAINER",
    team:data.teams[0],
    status:"WIP",
    lod:"0/300"
  });
  render();
}
function update(i,k,v){
  data.projects[data.active].containers[i][k]=v;
  render();
}

/* ===== RENDER ===== */
function render(){
  const p=data.projects[data.active];
  projectName.value=p.name;
  roleSelect.value=data.role;

  projectList.innerHTML="";
  data.projects.forEach((pr,i)=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerText=pr.name;
    d.onclick=()=>selectProject(i);
    projectList.appendChild(d);
  });

  tableBody.innerHTML="";
  p.containers.forEach((c,i)=>{
    const readOnly = data.role==="Client";
    tableBody.innerHTML+=`
    <tr>
      <td><input class="small" ${readOnly?"disabled":""} value="${c.id}" onchange="update(${i},'id',this.value)"></td>
      <td>
        <select class="small" ${readOnly?"disabled":""} onchange="update(${i},'team',this.value)">
          ${data.teams.map(t=>`<option ${t===c.team?"selected":""}>${t}</option>`).join("")}
        </select>
      </td>
      <td><input class="small" ${readOnly?"disabled":""} value="${c.status}" onchange="update(${i},'status',this.value)"></td>
      <td><input class="small" ${readOnly?"disabled":""} value="${c.lod}" onchange="update(${i},'lod',this.value)"></td>
    </tr>`;
  });

  kpiTotal.innerText=p.containers.length;
  kpiPublished.innerText=p.containers.filter(c=>c.status==="Published").length;
  kpiWip.innerText=p.containers.filter(c=>c.status==="WIP").length;
  kpiShared.innerText=p.containers.filter(c=>c.status==="Shared").length;

  save();
}

projectName.onchange=e=>{data.projects[data.active].name=e.target.value;render();}
applyRole();
</script>
</body>
</html>
