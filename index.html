<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SWITZELINT – BIM Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body { margin:0; font-family:Arial; background:#f3f4f6 }
.hidden { display:none }
.center { height:100vh; display:flex; align-items:center; justify-content:center }
.card { background:#fff; padding:20px; width:340px; border-radius:6px }
input, select, button { width:100%; padding:8px; margin:6px 0 }
.app { display:flex; height:100vh }
.sidebar { width:240px; background:#1f2933; color:#fff; padding:20px }
.sidebar button { margin-top:6px }
.main { flex:1; padding:20px; overflow:auto }
h3 { margin-top:0 }
.log { font-size:12px; color:#555 }
.badge { background:#2563eb; color:#fff; padding:4px 8px; border-radius:4px; font-size:12px }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="card">
    <h2>SWITZELINT</h2>
    <input id="username" placeholder="Your name" />
    <select id="role">
      <option value="Admin">Admin</option>
      <option value="Staff">Staff</option>
      <option value="Client">Client</option>
    </select>
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="app hidden">
  <div class="sidebar">
    <h3>SWITZELINT</h3>
    <p><span id="userName"></span></p>
    <p class="badge" id="roleBadge"></p>

    <button onclick="show('tasks')">Tasks</button>
    <button onclick="show('projects')">Projects</button>
    <button onclick="show('teams')">Teams</button>
    <button onclick="show('logs')">Logs</button>

    <button onclick="logout()">Logout</button>
  </div>

  <div class="main">
    <!-- TASKS -->
    <div id="tasksView">
      <h2>Tasks</h2>
      <input id="taskInput" placeholder="New task" />
      <button onclick="addTask()">Add Task</button>
      <ul id="taskList"></ul>
    </div>

    <!-- PROJECTS -->
    <div id="projectsView" class="hidden">
      <h2>Projects</h2>
      <input id="projectInput" placeholder="New project" />
      <button onclick="addProject()">Add Project</button>
      <ul id="projectList"></ul>
    </div>

    <!-- TEAMS -->
    <div id="teamsView" class="hidden">
      <h2>Teams</h2>
      <input id="teamInput" placeholder="New team" />
      <button onclick="addTeam()">Add Team</button>
      <ul id="teamList"></ul>
    </div>

    <!-- LOGS -->
    <div id="logsView" class="hidden">
      <h2>Activity Log</h2>
      <ul id="logList"></ul>
    </div>
  </div>
</div>

<script type="module">
/* =====================
   STEP 1–2: STATE
===================== */
let currentUser = null;
let currentRole = "Staff";

const tasks = [];
const projects = [];
const teams = [];
const logs = [];

/* =====================
   STEP 5: LOCAL STORAGE
===================== */
const STORAGE_KEY = "switzelint_offline_v1";

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    currentUser,
    currentRole,
    tasks,
    projects,
    teams,
    logs
  }));
}

function loadData() {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
  if (!data) return;

  currentUser = data.currentUser;
  currentRole = data.currentRole;
  tasks.push(...data.tasks);
  projects.push(...data.projects);
  teams.push(...data.teams);
  logs.push(...data.logs);
}

/* =====================
   AUTH
===================== */
window.login = () => {
  const name = document.getElementById("username").value;
  const role = document.getElementById("role").value;
  if (!name) return alert("Enter name");

  currentUser = name;
  currentRole = role;

  saveData();
  startApp();
  log(`${role} logged in`);
};

window.logout = () => {
  saveData();
  location.reload();
};

function startApp() {
  document.getElementById("login").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  document.getElementById("userName").innerText = currentUser;
  document.getElementById("roleBadge").innerText = currentRole;
  render();
}

/* =====================
   UI NAV
===================== */
window.show = view => {
  ["tasks","projects","teams","logs"].forEach(v=>{
    document.getElementById(v+"View").classList.add("hidden");
  });
  document.getElementById(view+"View").classList.remove("hidden");
};

/* =====================
   CRUD
===================== */
window.addTask = () => {
  const val = taskInput.value;
  if(!val) return;
  tasks.push({ text: val, done:false });
  taskInput.value="";
  log("Task added");
  saveData();
  render();
};

window.addProject = () => {
  const val = projectInput.value;
  if(!val) return;
  projects.push(val);
  projectInput.value="";
  log("Project added");
  saveData();
  render();
};

window.addTeam = () => {
  const val = teamInput.value;
  if(!val) return;
  teams.push(val);
  teamInput.value="";
  log("Team added");
  saveData();
  render();
};

/* =====================
   LOGGING
===================== */
function log(msg){
  logs.unshift(new Date().toLocaleString()+" — "+msg);
  saveData();
}

/* =====================
   RENDER
===================== */
function render(){
  taskList.innerHTML="";
  tasks.forEach((t,i)=>{
    const li=document.createElement("li");
    li.innerText=t.text;
    li.onclick=()=>{
      t.done=!t.done;
      li.style.textDecoration=t.done?"line-through":"";
      saveData();
    };
    if(t.done) li.style.textDecoration="line-through";
    taskList.appendChild(li);
  });

  projectList.innerHTML=projects.map(p=>`<li>${p}</li>`).join("");
  teamList.innerHTML=teams.map(t=>`<li>${t}</li>`).join("");
  logList.innerHTML=logs.map(l=>`<li class="log">${l}</li>`).join("");
}

/* =====================
   INIT
===================== */
loadData();
if(currentUser) startApp();
</script>

</body>
</html>
