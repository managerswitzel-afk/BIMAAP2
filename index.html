<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SWITZELINT | ISO 19650 CDE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f3f4f6}
.hidden{display:none}
.center{height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:#fff;padding:20px;width:380px;border-radius:6px}
input,select,textarea,button{width:100%;padding:8px;margin:6px 0}
button{cursor:pointer}
.app{display:flex;height:100vh}
.sidebar{width:260px;background:#1f2933;color:#fff;padding:20px}
.sidebar button{background:#374151;color:#fff;border:none;margin:4px 0}
.main{flex:1;padding:20px;overflow:auto}
.badge{background:#2563eb;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px}
.box{background:#fff;padding:12px;margin:10px 0;border-radius:6px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.kpi{background:#1d4ed8;color:#fff;padding:14px;border-radius:6px}
.kpi span{font-size:26px;font-weight:bold}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ddd;padding:6px;text-align:center}
.log{font-size:13px;border-left:4px solid #2563eb;padding-left:8px;margin:6px 0}
.status{font-weight:bold}
.Approved{color:#16a34a}
.Submitted{color:#2563eb}
.InProgress{color:#f59e0b}
.NotStarted{color:#6b7280}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="card">
    <h2>SWITZELINT</h2>
    <input id="username" placeholder="Username">
    <select id="role">
      <option>Admin</option>
      <option>Staff</option>
      <option>Client</option>
    </select>
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="app hidden">
  <div class="sidebar">
    <h3>SWITZELINT</h3>
    <p id="userInfo"></p>
    <span class="badge" id="roleBadge"></span>
    <hr>

    <select id="projectSelect" onchange="switchProject()"></select>

    <div id="projectAdmin">
      <input id="newProject" placeholder="New Project Name">
      <button onclick="addProject()">Add Project</button>
    </div>

    <hr>
    <button onclick="view('dashboard')">ðŸ“Š Dashboard</button>
    <button onclick="view('issues')">ðŸ“Œ Issues</button>
    <button onclick="view('documents')">ðŸ“„ Documents</button>
    <button onclick="view('transmittals')">ðŸ“¤ Transmittals</button>
    <button onclick="view('raci')">ðŸ§© RACI</button>
    <button onclick="view('idm')">ðŸ§± IDM Stages</button>
    <button onclick="view('audit')">ðŸ§¾ Audit</button>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="main">

<!-- DASHBOARD -->
<div id="dashboardView">
<h2>ISO 19650 Dashboard</h2>
<div class="grid" id="kpiGrid"></div>
</div>

<!-- IDM -->
<div id="idmView" class="hidden">
<h2>Information Delivery Milestones</h2>
<table>
<thead>
<tr><th>Stage</th><th>Status</th><th>Action</th></tr>
</thead>
<tbody id="idmTable"></tbody>
</table>
</div>

<!-- AUDIT -->
<div id="auditView" class="hidden">
<h2>Audit Log</h2>
<div id="auditLog"></div>
</div>

</div>
</div>

<script>
let user={},db=JSON.parse(localStorage.getItem("switzelint"))||{projects:{}},current=null;
const stages=["Stage 0 Strategic","Stage 1 Brief","Stage 2 Concept","Stage 3 Coordination","Stage 4 Technical","Stage 5 Construction","Stage 6 Handover"];
const statuses=["Not Started","In Progress","Submitted","Approved"];

function save(){localStorage.setItem("switzelint",JSON.stringify(db))}
function log(m){db.projects[current].audit.push(new Date().toISOString()+" â€” "+m);save();renderAudit()}

function login(){
user.name=username.value;user.role=role.value;
if(!db.projects.Main){
db.projects.Main={audit:[],idm:{}};
stages.forEach(s=>db.projects.Main.idm[s]="Not Started");
}
login.hidden=true;app.classList.remove("hidden");
userInfo.innerText=user.name;roleBadge.innerText=user.role;
loadProjects();
}

function logout(){location.reload()}
function loadProjects(){
projectSelect.innerHTML="";
Object.keys(db.projects).forEach(p=>projectSelect.add(new Option(p,p)));
current=projectSelect.value;renderAll();
}

function addProject(){
db.projects[newProject.value]={audit:[],idm:{}};
stages.forEach(s=>db.projects[newProject.value].idm[s]="Not Started");
save();loadProjects();
}

function switchProject(){current=projectSelect.value;renderAll()}
function view(v){
["dashboard","idm","audit"].forEach(x=>document.getElementById(x+"View").classList.add("hidden"));
document.getElementById(v+"View").classList.remove("hidden");
}

function setStage(stage,status){
db.projects[current].idm[stage]=status;
log(stage+" set to "+status);
renderIDM();
}

function renderIDM(){
idmTable.innerHTML="";
Object.entries(db.projects[current].idm).forEach(([s,st])=>{
idmTable.innerHTML+=`<tr>
<td>${s}</td>
<td class="${st.replace(" ","")}">${st}</td>
<td>${user.role==="Admin"?statuses.map(x=>`<button onclick="setStage('${s}','${x}')">${x}</button>`).join(""):""}</td>
</tr>`;
});
}

function renderAudit(){
auditLog.innerHTML="";
db.projects[current].audit.forEach(a=>auditLog.innerHTML+=`<div class="log">${a}</div>`);
}

function renderAll(){renderIDM();renderAudit()}
</script>

</body>
</html>
