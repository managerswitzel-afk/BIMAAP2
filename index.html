<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SWITZELINT – BIM Communication Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f3f4f6}
.app{display:flex;height:100vh}
.hidden{display:none}
.sidebar{width:300px;background:#1f2933;color:#fff;padding:20px}
.main{flex:1;padding:20px;overflow:auto}
button,select,input,textarea{padding:6px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e5e7eb;font-size:13px}
.log{background:#f9fafb;border:1px solid #e5e7eb;padding:8px;margin:6px 0}
.small{font-size:12px;color:#6b7280}
</style>
</head>

<body>
<div class="app">

<div class="sidebar">
  <h2>SWITZELINT</h2>
  <select id="roleSelect" onchange="setRole()">
    <option>BIM Manager</option>
    <option>Team Member</option>
    <option>Client</option>
  </select>
  <div id="projectList"></div>
</div>

<div class="main">
  <h2 id="projectName"></h2>
  <button onclick="addISO()">+ Add ISO Container</button>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Status</th>
        <th>LOD</th>
        <th>Communication</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>
</div>

<script>
let data=JSON.parse(localStorage.getItem("bimComms"));
if(!data){
  data={
    role:"BIM Manager",
    active:0,
    projects:[{name:"Hospital Project",containers:[]}]
  };
  save();
}
function save(){localStorage.setItem("bimComms",JSON.stringify(data));}

function setRole(){data.role=roleSelect.value;save();render();}

function addISO(){
  data.projects[data.active].containers.push({
    id:"ISO-"+(Date.now()%1000),
    status:"WIP",
    lod:"0/300",
    logs:[]
  });
  render();
}

function addLog(i){
  if(data.role==="Client"){alert("Read only");return;}
  const type=prompt("Type (WhatsApp / Email / Call / Meeting)");
  const summary=prompt("Summary / Decision");
  if(!type||!summary)return;
  data.projects[data.active].containers[i].logs.push({
    date:new Date().toLocaleString(),
    type,summary
  });
  render();
}

function render(){
  roleSelect.value=data.role;
  const p=data.projects[data.active];
  projectName.innerText=p.name;

  tableBody.innerHTML="";
  p.containers.forEach((c,i)=>{
    tableBody.innerHTML+=`
    <tr>
      <td>${c.id}</td>
      <td>${c.status}</td>
      <td>${c.lod}</td>
      <td>
        <button onclick="addLog(${i})">+ Log</button>
        ${c.logs.map(l=>`
          <div class="log">
            <strong>${l.type}</strong> – ${l.date}<br>
            <span class="small">${l.summary}</span>
          </div>`).join("")}
      </td>
    </tr>`;
  });
  save();
}
render();
</script>
</body>
</html>
