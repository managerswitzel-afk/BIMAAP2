<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SWITZELINT | ISO 19650 CDE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f3f4f6}
.hidden{display:none}
.center{height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:#fff;padding:20px;width:380px;border-radius:6px}
input,select,textarea,button{width:100%;padding:8px;margin:6px 0}
button{cursor:pointer}
.app{display:flex;height:100vh}
.sidebar{width:260px;background:#1f2933;color:#fff;padding:20px}
.sidebar button{background:#374151;color:#fff;border:none;margin:4px 0}
.main{flex:1;padding:20px;overflow:auto}
.badge{background:#2563eb;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px}
.box{background:#fff;padding:12px;margin:10px 0;border-radius:6px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.kpi{background:#1d4ed8;color:#fff;padding:14px;border-radius:6px}
.kpi span{font-size:26px;font-weight:bold}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ddd;padding:6px;text-align:center}
.log{font-size:13px;border-left:4px solid #2563eb;padding-left:8px;margin:6px 0}
.status{font-weight:bold}
.S0{color:#6b7280}.S1{color:#2563eb}.S2{color:#16a34a}
.S3{color:#f59e0b}.S4{color:#dc2626}.A{color:#16a34a}.B{color:#0f172a}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="card">
    <h2>SWITZELINT</h2>
    <input id="username" placeholder="Username">
    <select id="role">
      <option>Admin</option>
      <option>Staff</option>
      <option>Client</option>
    </select>
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="app hidden">
  <div class="sidebar">
    <h3>SWITZELINT</h3>
    <p id="userInfo"></p>
    <span class="badge" id="roleBadge"></span>
    <hr>

    <select id="projectSelect" onchange="switchProject()"></select>

    <div id="projectAdmin">
      <input id="newProject" placeholder="New Project Name">
      <button onclick="addProject()">Add Project</button>
    </div>

    <hr>
    <button onclick="view('dashboard')">ðŸ“Š Dashboard</button>
    <button onclick="view('issues')">ðŸ“Œ Issues</button>
    <button onclick="view('documents')">ðŸ“„ Documents</button>
    <button onclick="view('transmittals')">ðŸ“¤ Transmittals</button>
    <button onclick="view('raci')">ðŸ§© RACI Matrix</button>
    <button onclick="view('audit')">ðŸ§¾ Audit</button>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="main">

<!-- DASHBOARD -->
<div id="dashboardView">
<h2>ISO 19650 Dashboard</h2>
<div class="grid" id="kpiGrid"></div>
</div>

<!-- ISSUES -->
<div id="issuesView" class="hidden">
<h2>Issues / RFIs</h2>
<div class="box">
<input id="issueTitle" placeholder="Title">
<button onclick="addIssue()">Add</button>
</div>
<div id="issueList"></div>
</div>

<!-- DOCUMENTS -->
<div id="documentsView" class="hidden">
<h2>Documents</h2>
<div class="box" id="docAdmin">
<input id="docName" placeholder="Document Name">
<select id="docStatus">
<option>S0</option><option>S1</option><option>S2</option>
<option>S3</option><option>S4</option><option>A</option><option>B</option>
</select>
<select id="docSuitability">
<option>WIP</option><option>SHARED</option>
<option>PUBLISHED</option><option>ARCHIVED</option>
</select>
<button onclick="addDocument()">Register</button>
</div>
<table>
<thead><tr><th>Name</th><th>Status</th><th>Suitability</th></tr></thead>
<tbody id="docTable"></tbody>
</table>
</div>

<!-- TRANSMITTALS -->
<div id="transmittalsView" class="hidden">
<h2>Transmittals</h2>
<div class="box">
<input id="trPurpose" placeholder="Purpose">
<input id="trRecipient" placeholder="Recipient">
<button onclick="addTransmittal()">Create</button>
</div>
<table>
<thead><tr><th>ID</th><th>Purpose</th><th>Recipient</th><th>Status</th><th>Action</th></tr></thead>
<tbody id="trTable"></tbody>
</table>
</div>

<!-- RACI -->
<div id="raciView" class="hidden">
<h2>RACI Matrix</h2>
<table>
<thead>
<tr>
<th>Role</th>
<th>Info Mgmt</th>
<th>BIM Mgmt</th>
<th>Design</th>
<th>Construction</th>
<th>Approval</th>
</tr>
</thead>
<tbody id="raciTable"></tbody>
</table>
</div>

<!-- AUDIT -->
<div id="auditView" class="hidden">
<h2>Audit Log</h2>
<div id="auditLog"></div>
</div>

</div>
</div>

<script>
let user={},db=JSON.parse(localStorage.getItem("switzelint"))||{projects:{}},current=null;
const roles=["Information Manager","BIM Manager","Lead Designer","Contractor","Client"];
const tasks=["R","A","C","I"];

function save(){localStorage.setItem("switzelint",JSON.stringify(db))}
function log(m){db.projects[current].audit.push(new Date().toISOString()+" â€” "+m);save();renderAudit()}

function login(){
user.name=username.value;user.role=role.value;
if(!db.projects.Main){
db.projects.Main={issues:[],docs:[],trs:[],audit:[],raci:{}};
roles.forEach(r=>db.projects.Main.raci[r]=["I","I","I","I","I"]);
}
login.hidden=true;app.classList.remove("hidden");
userInfo.innerText=user.name;roleBadge.innerText=user.role;
loadProjects();
}

function logout(){location.reload()}
function loadProjects(){
projectSelect.innerHTML="";
Object.keys(db.projects).forEach(p=>projectSelect.add(new Option(p,p)));
current=projectSelect.value;renderAll();
}

function addProject(){
db.projects[newProject.value]={issues:[],docs:[],trs:[],audit:[],raci:{}};
roles.forEach(r=>db.projects[newProject.value].raci[r]=["I","I","I","I","I"]);
save();loadProjects();
}

function switchProject(){current=projectSelect.value;renderAll()}
function view(v){
["dashboard","issues","documents","transmittals","raci","audit"]
.forEach(x=>document.getElementById(x+"View").classList.add("hidden"));
document.getElementById(v+"View").classList.remove("hidden");
}

function addIssue(){db.projects[current].issues.push({t:issueTitle.value});log("Issue added");renderIssues()}
function addDocument(){db.projects[current].docs.push({n:docName.value,s:docStatus.value,u:docSuitability.value});log("Document registered");renderDocs()}
function addTransmittal(){db.projects[current].trs.push({id:"TR-"+(db.projects[current].trs.length+1),p:trPurpose.value,r:trRecipient.value,st:"Pending"});log("Transmittal created");renderTr()}
function approveTr(i){db.projects[current].trs[i].st="Approved";log("Transmittal approved");renderTr()}

function renderIssues(){issueList.innerHTML="";db.projects[current].issues.forEach(i=>issueList.innerHTML+=`<div class="box">${i.t}</div>`)}
function renderDocs(){docTable.innerHTML="";db.projects[current].docs.forEach(d=>docTable.innerHTML+=`<tr><td>${d.n}</td><td class="status ${d.s}">${d.s}</td><td>${d.u}</td></tr>`)}
function renderTr(){trTable.innerHTML="";db.projects[current].trs.forEach((t,i)=>trTable.innerHTML+=`<tr><td>${t.id}</td><td>${t.p}</td><td>${t.r}</td><td>${t.st}</td><td>${user.role==="Admin"&&t.st==="Pending"?`<button onclick="approveTr(${i})">Approve</button>`:""}</td></tr>`)}
function renderRaci(){
raciTable.innerHTML="";
roles.forEach(r=>{
raciTable.innerHTML+=`<tr>
<td>${r}</td>
${db.projects[current].raci[r].map((v,i)=>`<td>${user.role==="Admin"?`<select onchange="setRaci('${r}',${i},this.value)">${tasks.map(t=>`<option ${t===v?"selected":""}>${t}</option>`).join("")}</select>`:v}</td>`).join("")}
</tr>`;
});
}
function setRaci(r,i,v){db.projects[current].raci[r][i]=v;log("RACI updated");renderRaci()}
function renderAudit(){auditLog.innerHTML="";db.projects[current].audit.forEach(a=>auditLog.innerHTML+=`<div class="log">${a}</div>`)}
function renderAll(){renderIssues();renderDocs();renderTr();renderRaci();renderAudit()}
</script>

</body>
</html>
