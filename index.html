<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SWITZELINT – BIM LOD Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f3f4f6}
button{cursor:pointer}
.app{display:flex;height:100vh}
.sidebar{width:260px;background:#1f2933;color:#fff;padding:20px}
.sidebar h1{font-size:18px;margin:0}
.sidebar h2{font-size:13px;color:#cbd5e1;margin:5px 0 15px}
.sidebar button,select,input{
width:100%;padding:10px;margin-bottom:8px;border:none;
background:#374151;color:#fff;border-radius:4px
}
.main{flex:1;padding:20px;overflow:auto}
.topbar{display:flex;justify-content:space-between;margin-bottom:15px}
.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.kpi{background:#fff;padding:15px;border-radius:6px}
.kpi strong{font-size:24px}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center}
.modal-content{background:#fff;padding:20px;width:320px;border-radius:6px}
.modal-content input,select,button{width:100%;padding:10px;margin-bottom:8px}
table{width:100%;background:#fff;border-collapse:collapse}
th,td{padding:10px;border:1px solid #ddd;text-align:left}
</style>
</head>

<body>
<div id="app"></div>

<script>
let user=JSON.parse(localStorage.getItem("user"));
let projects=JSON.parse(localStorage.getItem("projects")||"{}");
let currentProject=localStorage.getItem("currentProject")||"Project Alpha";
if(!projects[currentProject]) projects[currentProject]=[];

function save(){localStorage.setItem("projects",JSON.stringify(projects));localStorage.setItem("currentProject",currentProject)}

const app=document.getElementById("app");

if(!user){login();} else {render();}

function login(){
app.innerHTML=`
<div class="modal">
<div class="modal-content">
<h3>Login</h3>
<input id="username" placeholder="Your name">
<select id="role">
<option>BIM Manager</option>
<option>Team Member</option>
<option>Client</option>
</select>
<button onclick="doLogin()">Login</button>
</div>
</div>`;
}

function doLogin(){
user={name:username.value,role:role.value};
localStorage.setItem("user",JSON.stringify(user));
render();
}

function logout(){
localStorage.removeItem("user");
location.reload();
}

function render(){
const tasks=projects[currentProject];
app.innerHTML=`
<div class="app">
<div class="sidebar">
<h1>SWITZELINT</h1>
<h2>${user.role}</h2>

${user.role==="BIM Manager"?`
<select onchange="switchProject(this.value)">
${Object.keys(projects).map(p=>`<option ${p===currentProject?"selected":""}>${p}</option>`).join("")}
</select>
<button onclick="addProject()">+ New Project</button>
`:``}

${user.role!=="Client"?`<button onclick="addTask()">+ New Task</button>`:``}
<button onclick="exportCSV()">Export Report</button>
<button onclick="logout()">Logout</button>
</div>

<div class="main">
<div class="topbar"><strong>${currentProject} – Dashboard</strong></div>
${dashboard(tasks)}
</div>
</div>`;
}

function dashboard(tasks){
const total=tasks.length;
const approved=tasks.filter(t=>t.status==="Approved").length;
const progress=tasks.reduce((a,t)=>a+(+t.lodCurrent||0)/(+t.lodTarget||1),0);
const percent=total?Math.round((progress/total)*100):0;
return `<div class="kpis">
<div class="kpi"><h4>Total Tasks</h4><strong>${total}</strong></div>
<div class="kpi"><h4>Approved</h4><strong>${approved}</strong></div>
<div class="kpi"><h4>Overall LOD %</h4><strong>${percent}%</strong></div>
</div>`;
}

function addProject(){
const n=prompt("Project name?");
if(n){projects[n]=[];currentProject=n;save();render();}
}

function switchProject(p){currentProject=p;save();render();}

function addTask(){
const name=prompt("Task name?");
if(name){
projects[currentProject].push({name,discipline:"ARC",lodCurrent:0,lodTarget:300,status:"Backlog",team:user.name});
save();render();
}
}

function exportCSV(){
let csv="Task,Status,LOD Current,LOD Target\n";
projects[currentProject].forEach(t=>{
csv+=`${t.name},${t.status},${t.lodCurrent},${t.lodTarget}\n`;
});
const blob=new Blob([csv],{type:"text/csv"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download=currentProject+"_Report.csv";
a.click();
}
</script>
</body>
</html>
